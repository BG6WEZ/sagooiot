import{_ as Z,b as g,E as ee}from"./index.1701184304695.js";import{L as te,h as a,S as le,T as o,ai as d,o as ue,b as T,_ as u,Y as i}from"./vue.1701184304695.js";const se={class:"mb-4 tr"},ae=i(" \u64CD\u4F5C"),oe=i("\u5168\u90E8\u52FE\u9009"),ne=i("\u53D6\u6D88\u5168\u9009"),ce=i("\u5C55\u5F00\u6240\u6709"),de=i("\u6298\u53E0\u6240\u6709"),ie=i("\u4E0A\u4E00\u6B65"),re=i("\u4E0B\u4E00\u6B65"),ve=i("\u786E\u5B9A"),_e=i("\u53D6\u6D88"),pe={class:"scroll-part mt-3"},fe=te({__name:"permission",setup(me,{expose:M}){const p=a(!1),y=a(!1),l=a(1),n=a(),F=a("\u89D2\u8272\u6743\u9650\u8BBE\u7F6E"),A=a(0),k=a([]),L=a([]),S=a([]),P=a([]),U=a([]),f=a([]),D=a([]),I=a([]),V=a([]),E=a([]),w=a([]),$=["menu","button","column","api"];let m=[f,I,E,w];const x=[L,S,P,U],Y={children:"children",label:"title"},C=(t,e=!1)=>{const s=[],c=[];return(t||[]).forEach(r=>{const[v,K]=r.split("_");K==="1"?s.push(Number(v)):c.push(Number(v))}),e?c:s},_=(t,e=!1)=>t.map(s=>`${s}_${e?0:1}`),j=async t=>{F.value="\u89D2\u8272\u6743\u9650\u8BBE\u7F6E - "+t.name,A.value=t.id,p.value=!0,l.value=1;const e=await g.role.getRoleIds(t.id);f.value=C(e.menuIds),I.value=C(e.buttonIds),E.value=C(e.columnIds),w.value=C(e.apiIds),n.value.setCheckedKeys(f.value);const s=await g.role.auth.getList($[l.value-1]);k.value=s,L.value=s},q=()=>{p.value=!1},H=t=>{const e=n.value.store.nodesMap;for(let s in e)e[s].expanded=t},z=async()=>{B(),k.value=x[l.value-2].value,n.value.setCheckedKeys(m[l.value-2].value),l.value=l.value-1},G=async()=>{B();const e=(await g.role.auth.getList($[l.value],f.value.concat(D.value))||[]).filter(s=>{var c;return(c=s.children)!=null&&c.length?(s.id+="_memu",!0):!1});k.value=e,x[l.value].value=e,n.value.setCheckedKeys(m[l.value].value),l.value=l.value+1},B=()=>{l.value===1?(m[l.value-1].value=n.value.getCheckedKeys(!1),D.value=n.value.getHalfCheckedKeys()):l.value===2?(m[l.value-1].value=n.value.getCheckedKeys(!1).filter(t=>typeof t=="number"),V.value=n.value.getHalfCheckedKeys().filter(t=>typeof t=="number")):m[l.value-1].value=n.value.getCheckedKeys(!0)},N=t=>{if(!t)n.value.setCheckedKeys([]);else{const e=R(x[l.value-1].value,[]);n.value.setCheckedKeys(e)}},J=async()=>{B();const t={menuIds:_(f.value).concat(_(D.value,!0)),buttonIds:_(I.value).concat(_(V.value,!0)),columnIds:_(E.value),apiIds:_(w.value),roleId:A.value};y.value=!0,g.role.auth.set(t).then(()=>{ee.success("\u6743\u9650\u8BBE\u7F6E\u6210\u529F")}).finally(()=>{y.value=!1,p.value=!1})};function R(t,e){var s;for(let c of t)e.push(c.id),(s=c.children)!=null&&s.length&&R(c.children,e);return e}return M({openDialog:j}),(t,e)=>{const s=d("ele-ArrowDown"),c=d("el-icon"),r=d("el-button"),v=d("el-dropdown-item"),K=d("el-dropdown-menu"),O=d("el-dropdown"),b=d("el-step"),Q=d("el-steps"),W=d("el-tree"),X=d("el-dialog");return ue(),le(X,{title:F.value,modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=h=>p.value=h),width:"1100px"},{default:o(()=>[T("div",se,[u(O,null,{dropdown:o(()=>[u(K,null,{default:o(()=>[u(v,{onClick:e[0]||(e[0]=h=>N(!0))},{default:o(()=>[oe]),_:1}),u(v,{onClick:e[1]||(e[1]=h=>N(!1))},{default:o(()=>[ne]),_:1}),u(v,{onClick:e[2]||(e[2]=h=>H(!0))},{default:o(()=>[ce]),_:1}),u(v,{onClick:e[3]||(e[3]=h=>H(!1))},{default:o(()=>[de]),_:1})]),_:1})]),default:o(()=>[u(r,{plain:"",class:"mr-3"},{default:o(()=>[ae,u(c,null,{default:o(()=>[u(s)]),_:1})]),_:1})]),_:1}),u(r,{disabled:l.value<=1,onClick:z},{default:o(()=>[ie]),_:1},8,["disabled"]),u(r,{disabled:l.value>=4,onClick:G},{default:o(()=>[re]),_:1},8,["disabled"]),u(r,{type:"primary",loading:y.value,onClick:J},{default:o(()=>[ve]),_:1},8,["loading"]),u(r,{onClick:q},{default:o(()=>[_e]),_:1})]),u(Q,{active:l.value,simple:"","finish-status":"success"},{default:o(()=>[u(b,{name:"",title:"\u83DC\u5355\u6743\u9650"}),u(b,{title:"\u6309\u94AE\u6743\u9650"}),u(b,{title:"\u5217\u8868\u6743\u9650"}),u(b,{title:"\u63A5\u53E3\u6743\u9650"})]),_:1},8,["active"]),T("div",pe,[u(W,{ref_key:"treeRef",ref:n,data:k.value,"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"",props:Y,"check-on-click-node":"","expand-on-click-node":!1},null,8,["data"])])]),_:1},8,["title","modelValue"])}}});var Ce=Z(fe,[["__scopeId","data-v-99f5b010"]]);export{Ce as default};
