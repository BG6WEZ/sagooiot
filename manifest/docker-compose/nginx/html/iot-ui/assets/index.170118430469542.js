import{L as q,h as y,a2 as Q,k as H,i as J,ab as X,a as j,_ as a,T as l,ai as n,as as V,o as p,b as Z,aa as $,U as r,S as h,X as x,V as ee,Y as D}from"./vue.1701184304695.js";import{_ as te,J as ae,b as _,h as R,E as v}from"./index.1701184304695.js";import le from"./editUser.1701184304695.js";import{a as ue}from"./useCommon.1701184304695.js";const oe=q({name:"systemUser",components:{EditUser:le},setup(){const e=y(),s=y(),N=y(""),k=y(),S=ae,{statusParams:C}=ue(),d=Q({loading:!1,ids:[],deptProps:{id:"deptId",children:"children",label:"deptName"},deptData:[],postData:[],roleData:[],tableData:{data:[],total:0,param:{status:-1,pageNum:1,pageSize:10,deptId:"",userNickname:"",userName:"",keyWords:"",mobile:"",dateRange:[]}}}),A=()=>{_.dept.getList(C).then(t=>{d.deptData=t}),_.post.getList(C).then(t=>{d.postData=t}),_.role.getList(C).then(t=>{d.roleData=t}),m()},m=()=>{d.loading=!0,_.user.getList(d.tableData.param).then(t=>{d.tableData.data=t.list,d.tableData.total=t.total}).finally(()=>{d.loading=!1})},w=()=>{e.value.openDialog()},E=t=>{e.value.openDialog(t)},c=t=>{let u="\u4F60\u786E\u5B9A\u8981\u5220\u9664\u6240\u9009\u7528\u6237\uFF1F";u=`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u7528\u6237\uFF1A\u201C${t.userName}\u201D\uFF0C\u662F\u5426\u7EE7\u7EED?`,R.confirm(u,"\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{_.user.del(t.id).then(()=>{v.success("\u5220\u9664\u6210\u529F"),m()})}).catch(()=>{})},b=t=>{d.tableData.param.pageSize=t},U=t=>{d.tableData.param.pageNum=t};return H(()=>{A()}),J(N,t=>{k.value.filter(t)}),{queryRef:s,editUserRef:e,onOpenAddUser:w,onOpenEditUser:E,onRowDel:c,onHandleSizeChange:b,onHandleCurrentChange:U,deptFilterNode:(t,u)=>t?u.deptName.includes(t):!0,filterText:N,treeRef:k,search:S,userList:m,handleSelectionChange:t=>{d.ids=t.map(u=>u.id)},handleNodeClick:t=>{d.tableData.param.deptId=t.deptId,m()},handleResetPwd:t=>{R.prompt('\u8BF7\u8F93\u5165"'+t.userName+'"\u7684\u65B0\u5BC6\u7801',"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(({value:u})=>{if(!u||u==""){v.success("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}_.user.resetPassword(t.id,u).then(()=>{v.success("\u4FEE\u6539\u6210\u529F\uFF0C\u65B0\u5BC6\u7801\u662F\uFF1A"+u)})}).catch(()=>{})},handleStatusChange:t=>{let u=t.status===1?"\u542F\u7528":"\u505C\u7528";R.confirm('\u786E\u8BA4\u8981"'+u+'"\uFF1A"'+t.userName+'"\u7528\u6237\u5417?',"\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(function(){return _.user.setStatus(t.id,t.status)}).then(()=>{v.success(u+"\u6210\u529F")}).catch(function(){t.status=t.status===0?1:0})},resetQuery:t=>{!t||(t.resetFields(),m())},...X(d)}}}),ne={class:"system-user-container"},se={class:"system-user-search mb15"},de=D(" \u67E5\u8BE2 "),re=D(" \u91CD\u7F6E "),ie=D(" \u65B0\u589E\u7528\u6237 "),pe=D("\u4FEE\u6539"),me=D("\u5220\u9664"),ce=D("\u91CD\u7F6E");function fe(e,s,N,k,S,C){const d=n("el-input"),A=n("el-tree"),m=n("el-scrollbar"),w=n("el-card"),E=n("el-col"),c=n("el-form-item"),b=n("el-option"),U=n("el-select"),z=n("el-date-picker"),L=n("ele-Search"),B=n("el-icon"),f=n("el-button"),P=n("ele-Refresh"),T=n("ele-FolderAdd"),t=n("el-form"),u=n("el-table-column"),K=n("el-switch"),M=n("el-table"),Y=n("pagination"),G=n("el-row"),I=n("EditUser"),O=n("EditPer"),F=V("auth"),i=V("col"),W=V("loading");return p(),j("div",ne,[a(G,{gutter:10},{default:l(()=>[a(E,{span:5},{default:l(()=>[a(w,{shadow:"hover"},{default:l(()=>[a(m,null,{default:l(()=>[a(d,{"prefix-icon":e.search,modelValue:e.filterText,"onUpdate:modelValue":s[0]||(s[0]=o=>e.filterText=o),placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",clearable:"",size:"default",style:{width:"100%"}},null,8,["prefix-icon","modelValue"]),a(A,{ref:"treeRef",class:"filter-tree mt-4",data:e.deptData,props:e.deptProps,"default-expand-all":"","filter-node-method":e.deptFilterNode,onNodeClick:e.handleNodeClick},null,8,["data","props","filter-node-method","onNodeClick"])]),_:1})]),_:1})]),_:1}),a(E,{span:19},{default:l(()=>[a(w,{shadow:"hover"},{default:l(()=>[Z("div",se,[a(t,{model:e.tableData.param,ref:"queryRef",inline:!0,"label-width":"68px"},{default:l(()=>[a(c,{label:"\u5173\u952E\u5B57",prop:"keyWords"},{default:l(()=>[a(d,{modelValue:e.tableData.param.keyWords,"onUpdate:modelValue":s[1]||(s[1]=o=>e.tableData.param.keyWords=o),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u8D26\u53F7\u6216\u59D3\u540D",clearable:"",size:"default",style:{width:"240px"},onKeyup:$(e.userList,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),a(c,{label:"\u624B\u673A\u53F7\u7801",prop:"mobile"},{default:l(()=>[a(d,{modelValue:e.tableData.param.mobile,"onUpdate:modelValue":s[2]||(s[2]=o=>e.tableData.param.mobile=o),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",clearable:"",size:"default",style:{width:"240px"},onKeyup:$(e.userList,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),a(c,{label:"\u72B6\u6001",prop:"status",style:{width:"200px"}},{default:l(()=>[a(U,{modelValue:e.tableData.param.status,"onUpdate:modelValue":s[3]||(s[3]=o=>e.tableData.param.status=o),placeholder:"\u7528\u6237\u72B6\u6001",size:"default",style:{width:"240px"}},{default:l(()=>[a(b,{label:"\u5168\u90E8",value:-1}),a(b,{label:"\u542F\u7528",value:1}),a(b,{label:"\u7981\u7528",value:0}),a(b,{label:"\u672A\u9A8C\u8BC1",value:2})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"dateRange"},{default:l(()=>[a(z,{modelValue:e.tableData.param.dateRange,"onUpdate:modelValue":s[4]||(s[4]=o=>e.tableData.param.dateRange=o),size:"default",style:{width:"240px"},"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),_:1}),a(c,null,{default:l(()=>[a(f,{size:"default",type:"primary",class:"ml10",onClick:e.userList},{default:l(()=>[a(B,null,{default:l(()=>[a(L)]),_:1}),de]),_:1},8,["onClick"]),a(f,{size:"default",onClick:s[5]||(s[5]=o=>e.resetQuery(e.queryRef))},{default:l(()=>[a(B,null,{default:l(()=>[a(P)]),_:1}),re]),_:1}),r((p(),h(f,{size:"default",type:"success",class:"ml10",onClick:e.onOpenAddUser},{default:l(()=>[a(B,null,{default:l(()=>[a(T)]),_:1}),ie]),_:1},8,["onClick"])),[[F,"add"]])]),_:1})]),_:1},8,["model"])]),r((p(),h(M,{data:e.tableData.data,style:{width:"100%"},onSelectionChange:e.handleSelectionChange},{default:l(()=>[a(u,{type:"index",label:"\u5E8F\u53F7",width:"60",align:"center"}),r(a(u,{prop:"userName",label:"\u8D26\u6237\u540D\u79F0","min-width":"120","show-overflow-tooltip":""},null,512),[[i,"userName"]]),r(a(u,{prop:"userNickname",label:"\u7528\u6237\u6635\u79F0","min-width":"160","show-overflow-tooltip":""},null,512),[[i,"userNickname"]]),r(a(u,{prop:"dept.deptName",label:"\u90E8\u95E8","show-overflow-tooltip":""},null,512),[[i,"deptName"]]),r(a(u,{label:"\u89D2\u8272","min-width":"120",prop:"rolesNames","show-overflow-tooltip":!0},null,512),[[i,"rolesNames"]]),r(a(u,{prop:"mobile",label:"\u624B\u673A\u53F7",width:"120",align:"center"},null,512),[[i,"mobile"]]),r((p(),h(u,{prop:"status",label:"\u7528\u6237\u72B6\u6001",width:"120",align:"center"},{default:l(o=>[r(a(K,{modelValue:o.row.status,"onUpdate:modelValue":g=>o.row.status=g,disabled:o.row.id===1,"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"\u542F","inactive-text":"\u7981",onChange:g=>e.handleStatusChange(o.row)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),[[F,"change-status"]])]),_:1})),[[i,"status"]]),r(a(u,{prop:"createdAt",label:"\u521B\u5EFA\u65F6\u95F4",width:"180",align:"center"},null,512),[[i,"createdAt"]]),r((p(),h(u,{label:"\u64CD\u4F5C",width:"180",align:"center",fixed:"right"},{default:l(o=>[r((p(),h(f,{size:"small",text:"",type:"warning",onClick:g=>e.onOpenEditUser(o.row)},{default:l(()=>[pe]),_:2},1032,["onClick"])),[[F,"edit"]]),o.row.id!==1?r((p(),h(f,{key:0,size:"small",text:"",type:"danger",onClick:g=>e.onRowDel(o.row)},{default:l(()=>[me]),_:2},1032,["onClick"])),[[F,"del"]]):x("",!0),r((p(),h(f,{size:"small",text:"",type:"success",onClick:g=>e.handleResetPwd(o.row)},{default:l(()=>[ce]),_:2},1032,["onClick"])),[[F,"reset"]])]),_:1})),[[i,"handle"]])]),_:1},8,["data","onSelectionChange"])),[[W,e.loading]]),r(a(Y,{total:e.tableData.total,page:e.tableData.param.pageNum,"onUpdate:page":s[6]||(s[6]=o=>e.tableData.param.pageNum=o),limit:e.tableData.param.pageSize,"onUpdate:limit":s[7]||(s[7]=o=>e.tableData.param.pageSize=o),onPagination:e.userList},null,8,["total","page","limit","onPagination"]),[[ee,e.tableData.total>0]])]),_:1})]),_:1})]),_:1}),a(I,{ref:"editUserRef","dept-data":e.deptData,"post-data":e.postData,"role-data":e.roleData,onGetUserList:e.userList},null,8,["dept-data","post-data","role-data","onGetUserList"]),a(O,{ref:"editPerRef",onGetUserList:e.userList},null,8,["onGetUserList"])])}var Fe=te(oe,[["render",fe]]);export{Fe as default};
