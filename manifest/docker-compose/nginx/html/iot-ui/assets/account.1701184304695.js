import{L as v,a2 as A,k as R,l as b,ab as U,S as $,T as s,aD as q,aF as D,ai as l,o as N,_ as o,aa as k,b as _,O as B,Z as K,j as O}from"./vue.1701184304695.js";import{_ as T,c as M,b as S,u as j,S as E,i as z,e as J,E as H,f as L}from"./index.1701184304695.js";const P={}.VITE_ISOPEN,Z=v({name:"loginAccount",setup(){const{t:e}=M(),n=j(),p=q(),g=D(),{proxy:h}=O(),u=A({isShowPassword:!1,ruleForm:{userName:P?"demo":"",password:P?"demo123456":"",captcha:"",VerifyKey:""},formRules:{userName:[{required:!0,trigger:"blur",message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"}],password:[{required:!0,trigger:"blur",message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"}],captcha:[{required:!0,trigger:"blur",message:"\u9A8C\u8BC1\u7801\u4E0D\u80FD\u4E3A\u7A7A"}]},loading:{signIn:!1},captchaSrc:""});R(()=>{c()});const y=b(()=>L(new Date)),c=()=>{S.login.captcha().then(a=>{u.captchaSrc=a.img,u.ruleForm.VerifyKey=a.key})},d=()=>{h.$refs.loginForm.validate(a=>{a&&(u.loading.signIn=!0,S.login.login(u.ruleForm).then(async r=>{const i=r.userInfo;i.avatar=h.getUpFileUrl(i.avatar),localStorage.setItem("token",r.token),E.set("userInfo",i),await n.dispatch("userInfos/setUserInfos",i),m()}).catch(()=>{u.loading.signIn=!1,c()}))}).catch(()=>{})},m=async()=>{S.login.currentUser().then(async a=>{localStorage.setItem("userId",a.Info.id),E.set("userMenu",a.Data||[]),n.dispatch("requestOldRoutes/setBackEndControlRoutes",a||[]),n.state.themeConfig.themeConfig.isRequestRoutes?(await J(),f()):(await z(),f())})},f=()=>{var t,w,C,F;const a=JSON.parse(localStorage.sysinfo||"{}"),r=g.getRoutes().find(V=>V.path==="/");r&&(r.redirect=a.systemHomePageRoute||"/home");let i=y.value;(t=p.query)!=null&&t.redirect?g.push({path:(w=p.query)==null?void 0:w.redirect,query:p.query.params&&Object.keys((C=p.query)==null?void 0:C.params).length>0?JSON.parse((F=p.query)==null?void 0:F.params):""}):g.push("/"),u.loading.signIn=!1;const I=e("message.signInText");H.success(`${i}\uFF0C${I}`)};return{onSignIn:d,getCaptcha:c,...U(u)}}}),G={class:"login-content-code"},Q=["src"];function W(e,n,p,g,h,u){const y=l("ele-User"),c=l("el-icon"),d=l("el-input"),m=l("el-form-item"),f=l("ele-Unlock"),a=l("ele-Position"),r=l("el-col"),i=l("el-button"),I=l("el-form");return N(),$(I,{ref:"loginForm",size:"large",class:"login-content-form",model:e.ruleForm,rules:e.formRules},{default:s(()=>[o(m,{class:"login-animation1",prop:"userName"},{default:s(()=>[o(d,{type:"text",placeholder:e.$t("message.account.accountPlaceholder1"),modelValue:e.ruleForm.userName,"onUpdate:modelValue":n[0]||(n[0]=t=>e.ruleForm.userName=t),clearable:"",autocomplete:"off"},{prefix:s(()=>[o(c,{class:"el-input__icon"},{default:s(()=>[o(y)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),o(m,{class:"login-animation2",prop:"password"},{default:s(()=>[o(d,{type:e.isShowPassword?"text":"password",placeholder:e.$t("message.account.accountPlaceholder2"),modelValue:e.ruleForm.password,"onUpdate:modelValue":n[2]||(n[2]=t=>e.ruleForm.password=t),autocomplete:"off",onKeyup:k(e.onSignIn,["enter"])},{prefix:s(()=>[o(c,{class:"el-input__icon"},{default:s(()=>[o(f)]),_:1})]),suffix:s(()=>[_("i",{class:B(["iconfont el-input__icon login-content-password",e.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:n[1]||(n[1]=t=>e.isShowPassword=!e.isShowPassword)},null,2)]),_:1},8,["type","placeholder","modelValue","onKeyup"])]),_:1}),o(m,{class:"login-animation3",prop:"captcha"},{default:s(()=>[o(r,{span:15},{default:s(()=>[o(d,{type:"text",maxlength:"4",placeholder:e.$t("message.account.accountPlaceholder3"),modelValue:e.ruleForm.captcha,"onUpdate:modelValue":n[3]||(n[3]=t=>e.ruleForm.captcha=t),clearable:"",autocomplete:"off",onKeyup:k(e.onSignIn,["enter"])},{prefix:s(()=>[o(c,{class:"el-input__icon"},{default:s(()=>[o(a)]),_:1})]),_:1},8,["placeholder","modelValue","onKeyup"])]),_:1}),o(r,{span:1}),o(r,{span:8},{default:s(()=>[_("div",G,[_("img",{class:"login-content-code-img",onClick:n[4]||(n[4]=(...t)=>e.getCaptcha&&e.getCaptcha(...t)),width:"130",height:"38",src:e.captchaSrc,style:{cursor:"pointer"}},null,8,Q)])]),_:1})]),_:1}),o(m,{class:"login-animation4"},{default:s(()=>[o(i,{type:"primary",class:"login-content-submit",onClick:e.onSignIn,loading:e.loading.signIn},{default:s(()=>[_("span",null,K(e.$t("message.account.accountBtnText")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])}var x=T(Z,[["render",W],["__scopeId","data-v-647d66fc"]]);export{x as default};
