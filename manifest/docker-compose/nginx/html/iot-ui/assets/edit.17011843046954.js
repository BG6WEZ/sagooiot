import{a as Z}from"./index.17011843046957.js";import{a as H}from"./index.170118430469519.js";import{a as A}from"./index.17011843046958.js";import{a as L}from"./index.170118430469520.js";import{_ as J,t as Q,v as x,w as ee,x as te,y as oe,z as le,A as ae,B as ue,C as ne,E as X}from"./index.1701184304695.js";import{L as re,h as Y,a2 as de,i as se,ab as ie,a as p,_ as o,T as a,j as pe,e as ce,ai as g,o as n,b as y,Y as E,Z as w,F as v,a8 as _,S as h,X as T}from"./vue.1701184304695.js";const me=re({name:"Edit",components:{Delete:Q,Plus:x,CircleClose:ee,Minus:te,Right:oe,Top:le,Bottom:ae,CirclePlus:ue,Remove:ne},setup(l,{emit:s}){const M=Y(null),R=Y(null),{proxy:j}=pe(),{notice_send_gateway:W}=j.useDict("notice_send_gateway"),e=de({id:0,isShowDialog:!1,sourceData:[],tempData:[],productData:[],typeData:[],triData:[],operData:[],levelData:[],sendGatewayData:[],noticeConfigData:[],eventList:[],action:[{sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:[{phone:""}]}],requestParams:[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}],ruleForm:{id:0,name:"",triggerType:1,eventKey:"",level:"",productKey:"",deviceKey:"",action:[{sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:{}}],triggerCondition:[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}]},rules:{name:[{required:!0,message:"\u544A\u8B66\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],level:[{required:!0,message:"\u544A\u8B66\u7EA7\u522B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productKey:[{required:!0,message:"\u8BF7\u9009\u62E9\u4EA7\u54C1",trigger:"blur"}],deviceKey:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBE\u5907",trigger:"blur"}]}}),k=r=>{U(),P(),r&&A.common.detail(r.id).then(d=>{e.requestParams=d.data.condition.triggerCondition,d.data.performAction.action.forEach(function(c,b){L.config.getList({sendGateway:c.sendGateway}).then(B=>{e.sendGatewayData[b]=B.Data}),c.noticeConfig&&L.template.configIddetail(c.noticeConfig).then(B=>{e.noticeConfigData[b]=[B]})}),e.action=d.data.performAction.action,e.action.forEach(function(c,b){e.action[b].addressee=c.addressee.map(B=>({phone:B}))}),e.ruleForm=d.data,q(!0)}),e.isShowDialog=!0},P=()=>{H.product.getLists({status:1}).then(r=>{e.productData=r.product||[]}),A.common.levelall("").then(r=>{e.levelData=r.list||[]}),A.common.operator("").then(r=>{e.operData=r.list||[]})},U=()=>{e.requestParams=[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}],e.action=[{sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:[{phone:""}]}],e.ruleForm={id:0,name:"",triggerType:1,level:"",productKey:"",deviceKey:"",action:[{sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:{}}],triggerCondition:[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}]}},m=()=>{e.isShowDialog=!1},F=()=>{m()},K=()=>{f()};se(()=>e.ruleForm.productKey,r=>{!r||(e.ruleForm.eventKey="")});const O=()=>{const r=ce(R);!r||r.validate(d=>{d&&(e.ruleForm.triggerCondition=e.requestParams,e.action.forEach(function(c,b){e.action[b].addressee=c.addressee.map(B=>B.phone)}),e.ruleForm.action=e.action,e.ruleForm.id!==0?A.common.edit(e.ruleForm).then(()=>{X.success("\u544A\u8B66\u4FEE\u6539\u6210\u529F"),m(),s("typeList")}):A.common.add(e.ruleForm).then(()=>{X.success("\u544A\u8B66\u6DFB\u52A0\u6210\u529F"),m(),s("dataList")}))})},C=r=>{e.action[r].addressee.push({phone:""})},G=(r,d)=>{e.action[r].addressee.splice(d,1)},$=()=>{e.action.push({sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:[{phone:""}]})},S=r=>{e.action.splice(r,1)},V=r=>{e.requestParams.splice(r,1)},z=(r,d)=>{e.requestParams[r].filters.splice(d,1)},N=()=>{e.requestParams.push({andOr:"",filters:[{key:"",operator:"",value:"",andOr:""}]})},I=r=>{e.requestParams[r].filters.push({key:"",operator:"",value:"",andOr:""})},q=r=>{!r&&(e.ruleForm.deviceKey="");let d=0;e.productData.forEach((c,b)=>{c.key==e.ruleForm.productKey&&(d=c.id)}),Z.common.getdevList({productId:d}).then(c=>{e.sourceData=c.device}),A.common.trigger_type(e.ruleForm.productKey).then(c=>{e.typeData=c.list||[]}),f()},t=()=>{f()},f=()=>{e.requestParams=[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}],u()};function u(){e.triData=[];const r=e.ruleForm.triggerType,d={productKey:e.ruleForm.productKey,triggerType:r};r===4&&(d.eventKey=e.ruleForm.eventKey,!d.eventKey)||A.common.trigger_params(d).then(c=>{e.triData=c.list||[]})}return{getRadio:t,gettriData:f,getTem:(r,d)=>{e.action[d].noticeTemplate="",L.template.configIddetail(r).then(c=>{e.noticeConfigData[d]=[c]})},getNode:(r,d)=>{e.action[d].noticeConfig="",L.config.getList({sendGateway:r}).then(c=>{e.sendGatewayData[d]=c.Data})},delAction:S,addAction:$,eventTypeChange:K,AddPhone:C,DelPhone:G,setType:q,addParams:I,addParamss:N,delParamss:z,delParams:V,openDialog:k,closeDialog:m,getDevData:P,onCancel:F,onSubmit:O,formRef:R,notice_send_gateway:W,myRef:M,...ie(e)}}}),fe={class:"system-edit-dic-container"},ye={style:{float:"left"}},ge={style:{float:"right","font-size":"13px"}},ve={style:{float:"left"}},_e={style:{float:"right","font-size":"13px"}},he=E("\u89E6\u53D1\u6761\u4EF6"),Fe={class:"box-content"},Ce={key:0,style:{"text-align":"center"}},Ee={style:{padding:"10px",border:"1px solid var(--next-border-color-light)","background-color":"var(--next-border-color-light)","margin-bottom":"10px",position:"relative"}},De={class:"conicon",style:{width:"100%","text-align":"right",position:"absolute",right:"-8px",top:"-8px",color:"red"}},ke={style:{display:"flex"}},Ve=E("\u53C2\u6570\u8BBE\u7F6E"),be={key:0,style:{"text-align":"center"}},Be={class:"content-f"},Ae={class:"conicon"},we=E("\u589E\u52A0\u6761\u4EF6"),Ke=E("\u589E\u52A0\u5206\u7EC4"),Te=E("\u6267\u884C\u52A8\u4F5C"),Pe={class:"box-content"},Ue={style:{padding:"10px",border:"1px solid var(--next-border-color-light)","background-color":"var(--next-border-color-light)","margin-bottom":"10px",position:"relative"}},Oe={class:"conicon",style:{width:"100%","text-align":"right",position:"absolute",right:"-8px",top:"-8px",color:"red"}},Ge={style:{display:"flex"}},$e=E("\u6D88\u606F\u901A\u77E5"),qe={class:"content-f"},Le=E("\u589E\u52A0\u6267\u884C"),Re={class:"dialog-footer"},Se=E("\u53D6 \u6D88");function ze(l,s,M,R,j,W){const e=g("el-input"),k=g("el-form-item"),P=g("el-radio"),U=g("el-radio-group"),m=g("el-option"),F=g("el-select"),K=g("el-divider"),O=g("Top"),C=g("el-icon"),G=g("Bottom"),$=g("CircleClose"),S=g("Delete"),V=g("el-button"),z=g("CirclePlus"),N=g("Remove"),I=g("el-form"),q=g("el-dialog");return n(),p("div",fe,[o(q,{title:(l.ruleForm.id!==0?"\u4FEE\u6539":"\u6DFB\u52A0")+"\u544A\u8B66",modelValue:l.isShowDialog,"onUpdate:modelValue":s[8]||(s[8]=t=>l.isShowDialog=t),width:"50%"},{footer:a(()=>[y("span",Re,[o(V,{onClick:l.onCancel,size:"default"},{default:a(()=>[Se]),_:1},8,["onClick"]),o(V,{type:"primary",onClick:l.onSubmit,size:"default"},{default:a(()=>[E(w(l.ruleForm.id!==0?"\u4FEE \u6539":"\u6DFB \u52A0"),1)]),_:1},8,["onClick"])])]),default:a(()=>[o(I,{model:l.ruleForm,ref:"formRef",rules:l.rules,size:"default","label-width":"110px"},{default:a(()=>[o(k,{label:"\u540D\u79F0",prop:"name"},{default:a(()=>[o(e,{modelValue:l.ruleForm.name,"onUpdate:modelValue":s[0]||(s[0]=t=>l.ruleForm.name=t),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(k,{label:"\u544A\u8B66\u7EA7\u522B",prop:"level"},{default:a(()=>[o(U,{modelValue:l.ruleForm.level,"onUpdate:modelValue":s[1]||(s[1]=t=>l.ruleForm.level=t)},{default:a(()=>[(n(!0),p(v,null,_(l.levelData,t=>(n(),h(P,{label:t.level},{default:a(()=>[E(w(t.name),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(k,{label:"\u9009\u62E9\u4EA7\u54C1",prop:"productKey"},{default:a(()=>[o(F,{modelValue:l.ruleForm.productKey,"onUpdate:modelValue":s[2]||(s[2]=t=>l.ruleForm.productKey=t),filterable:"",placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",onChange:s[3]||(s[3]=t=>l.setType())},{default:a(()=>[(n(!0),p(v,null,_(l.productData,t=>(n(),h(m,{key:t.key,label:t.name,value:t.key},{default:a(()=>[y("span",ye,w(t.name),1),y("span",ge,w(t.key),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(k,{label:"\u9009\u62E9\u8BBE\u5907",prop:"deviceKey"},{default:a(()=>[o(F,{modelValue:l.ruleForm.deviceKey,"onUpdate:modelValue":s[4]||(s[4]=t=>l.ruleForm.deviceKey=t),filterable:"",placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907"},{default:a(()=>[(n(!0),p(v,null,_(l.sourceData,t=>(n(),h(m,{key:t.key,label:t.name,value:t.key},{default:a(()=>[y("span",ve,w(t.name),1),y("span",_e,w(t.key),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l.ruleForm.productKey?(n(),h(k,{key:0,label:"\u89E6\u53D1\u65B9\u5F0F",prop:"triggerType"},{default:a(()=>[o(U,{modelValue:l.ruleForm.triggerType,"onUpdate:modelValue":s[5]||(s[5]=t=>l.ruleForm.triggerType=t),onChange:s[6]||(s[6]=t=>l.getRadio())},{default:a(()=>[(n(!0),p(v,null,_(l.typeData,t=>(n(),h(P,{label:t.type},{default:a(()=>[E(w(t.title),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1})):T("",!0),l.ruleForm.triggerType===4?(n(),h(k,{key:1,label:"\u9009\u62E9\u4E8B\u4EF6",prop:"eventKey"},{default:a(()=>[o(F,{modelValue:l.ruleForm.eventKey,"onUpdate:modelValue":s[7]||(s[7]=t=>l.ruleForm.eventKey=t),filterable:"",placeholder:"\u8BF7\u9009\u62E9\u4E8B\u4EF6",onChange:l.eventTypeChange},{default:a(()=>[(n(!0),p(v,null,_(l.eventList,t=>(n(),h(m,{key:t.key,label:t.name,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})):T("",!0),o(K,{"content-position":"left"},{default:a(()=>[he]),_:1}),y("div",Fe,[(n(!0),p(v,null,_(l.requestParams,(t,f)=>(n(),p("div",{key:f},[f>0?(n(),p("div",Ce,[o(C,null,{default:a(()=>[o(O)]),_:1}),y("div",null,[o(F,{modelValue:t.andOr,"onUpdate:modelValue":u=>t.andOr=u,placeholder:"\u9009\u62E9\u6761\u4EF6\u5173\u7CFB"},{default:a(()=>[o(m,{label:"\u65E0",value:0}),o(m,{label:"\u5E76\u4E14",value:1}),o(m,{label:"\u6216",value:2})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),o(C,null,{default:a(()=>[o(G)]),_:1})])):T("",!0),y("div",Ee,[y("div",De,[o(C,{onClick:u=>l.delParams(f)},{default:a(()=>[o($)]),_:2},1032,["onClick"])]),y("div",ke,[o(K,{"content-position":"left"},{default:a(()=>[Ve]),_:1})]),(n(!0),p(v,null,_(t.filters,(u,D)=>(n(),p("div",{key:D},[D>0?(n(),p("div",be,[o(C,null,{default:a(()=>[o(O)]),_:1}),y("div",null,[o(F,{modelValue:u.andOr,"onUpdate:modelValue":i=>u.andOr=i,placeholder:"\u9009\u62E9\u6761\u4EF6\u5173\u7CFB",style:{width:"150px"}},{default:a(()=>[o(m,{label:"\u65E0",value:0}),o(m,{label:"\u5E76\u4E14",value:1}),o(m,{label:"\u6216",value:2})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),o(C,null,{default:a(()=>[o(G)]),_:1})])):T("",!0),y("div",Be,[o(F,{modelValue:u.key,"onUpdate:modelValue":i=>u.key=i,placeholder:l.ruleForm.triggerType===4&&!l.ruleForm.eventKey?"\u8BF7\u5148\u9009\u62E9\u4E8B\u4EF6":"\u9009\u62E9\u53C2\u6570",style:{width:"320px"}},{default:a(()=>[(n(!0),p(v,null,_(l.triData,i=>(n(),h(m,{key:i.paramKey,label:i.title,value:i.paramKey},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),o(F,{modelValue:u.operator,"onUpdate:modelValue":i=>u.operator=i,placeholder:"\u9009\u62E9\u64CD\u4F5C\u7B26",style:{width:"320px"}},{default:a(()=>[(n(!0),p(v,null,_(l.operData,i=>(n(),h(m,{key:i.type,label:i.title,value:i.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(e,{modelValue:u.value,"onUpdate:modelValue":i=>u.value=i,placeholder:"\u8BF7\u8F93\u5165\u6761\u4EF6\u503C",style:{width:"320px"}},null,8,["modelValue","onUpdate:modelValue"]),y("div",Ae,[o(C,{onClick:i=>l.delParamss(f,D)},{default:a(()=>[o(S)]),_:2},1032,["onClick"])])])]))),128)),o(V,{type:"primary",class:"addbutton",onClick:u=>l.addParams(f)},{default:a(()=>[we]),_:2},1032,["onClick"])])]))),128))]),o(V,{type:"success",class:"addbutton",onClick:l.addParamss},{default:a(()=>[Ke]),_:1},8,["onClick"]),o(K,{"content-position":"left"},{default:a(()=>[Te]),_:1}),y("div",Pe,[(n(!0),p(v,null,_(l.action,(t,f)=>(n(),p("div",{key:f},[y("div",Ue,[y("div",Oe,[o(C,{onClick:u=>l.delAction(f)},{default:a(()=>[o($)]),_:2},1032,["onClick"])]),y("div",Ge,[o(K,{"content-position":"left"},{default:a(()=>[$e]),_:1})]),y("div",qe,[o(F,{modelValue:t.sendGateway,"onUpdate:modelValue":u=>t.sendGateway=u,placeholder:"\u8BF7\u9009\u62E9\u901A\u77E5\u65B9\u5F0F",style:{width:"320px"},onChange:u=>l.getNode(t.sendGateway,f)},{default:a(()=>[(n(!0),p(v,null,_(l.notice_send_gateway,u=>(n(),h(m,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),o(F,{modelValue:t.noticeConfig,"onUpdate:modelValue":u=>t.noticeConfig=u,placeholder:"\u8BF7\u9009\u62E9\u901A\u77E5\u914D\u7F6E",style:{width:"320px"},onChange:u=>l.getTem(t.noticeConfig,f)},{default:a(()=>[(n(!0),p(v,null,_(l.sendGatewayData[f],u=>(n(),h(m,{key:u.id,label:u.title,value:u.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),o(F,{modelValue:t.noticeTemplate,"onUpdate:modelValue":u=>t.noticeTemplate=u,placeholder:"\u8BF7\u9009\u62E9\u901A\u77E5\u6A21\u677F",style:{width:"320px"}},{default:a(()=>[(n(!0),p(v,null,_(l.noticeConfigData[f],u=>(n(),h(m,{key:u.id,label:u.title,value:u.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),y("div",null,[(n(!0),p(v,null,_(t.addressee,(u,D)=>(n(),p("div",{style:{display:"flex","margin-bottom":"10px"},key:D},[o(e,{modelValue:u.phone,"onUpdate:modelValue":i=>u.phone=i,placeholder:"\u8BF7\u8F93\u5165\u63A5\u6536\u4EBA\u4FE1\u606F",style:{width:"320px"}},null,8,["modelValue","onUpdate:modelValue"]),D==0?(n(),h(C,{key:0,style:{width:"32px",height:"32px","font-size":"24px"},onClick:i=>l.AddPhone(f)},{default:a(()=>[o(z)]),_:2},1032,["onClick"])):T("",!0),D>0?(n(),h(C,{key:1,style:{width:"32px",height:"32px","font-size":"24px"},onClick:i=>l.DelPhone(f,D)},{default:a(()=>[o(N)]),_:2},1032,["onClick"])):T("",!0)]))),128))])])]))),128))]),o(V,{type:"success",class:"addbutton",onClick:l.addAction},{default:a(()=>[Le]),_:1},8,["onClick"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}var Ye=J(me,[["render",ze]]);export{Ye as default};
